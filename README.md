# st-feign-mocker
对 Spring Cloud OpenFeign 的远程请求的东西进行 Mock，适用于开发阶段的自测与测试阶段的异常测试。

## 背景
在微服务大环境下，单个服务的功能往往要依赖一系列下游服务才能正常运行；此时就存在开发与测试阶段对于 Mock 的需求了。

### 微服务开发者的自测困境
在微服务开发时，微服务之间往往有上下游关系；如果上游微服务开发出一些功能想要自测时，可能下游系统还未完成，没办法提供可用的环境；
此时作为上游系统开发者，需要有一种手段对下游系统进行 Mock 。

目前来说，开发者往往会采用以下办法进行 Mock：

- 将代码写死，return 固定值
- 写多个 RPC 实现类，开发阶段加载其中一个
- 写个过滤器，在本地开发时加载，将 RPC 进行拦截

这些方法可能存在风险，万一提交测试之前忘记删掉，或者加载机制出了问题，都会引起严重的 BUG ；而且这些东西一般都是只能用一次的临时代码，又不算工作量的。

### 测试人员异常测试的困境
有时会存在多名测试人员对同一个系统不同模块进行测试的场景。当测试人员在验证异常案例，需要模拟超时场景时，很多时候会使用 `iptables` 
防火墙，配合 `-m string --string 'xxx'` 参数，对某些 IP 进行拦截；但这个方法比较复杂，且很容易误伤，引起一系列降低工作效率的问题。

## 概要设计
本项目目前仅面向 `Spring Cloud OpenFeign` 设计，当更多框架的需求存在时再进行扩展。

预计做出一款集成到工程里的组件，来完成 RPC 功能的 Mock；它要完成以下功能：
- 做一个过滤器，调用 FeignClient 时进行拦截处理
  - 若匹配到规则，则按规则执行；否则正常发送
- 匹配 Mock 规则，可根据：
  - RPC 请求报文要素
  - RPC URL
  - 用 sql 查表数据（select one）
- Mock 规则包含
  - 定制报文返回
  - 定制 HTTP 头
  - 模拟连接失败异常
  - 模拟接收超时
- 界面化配置 Mock 规则
- 将规则持久化
  - 预计使用 `$HOME/.config/st-feign-mocker/${spring.application.name}.h2`
